<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ArxivCaster — Daily Papers</title>
    <style>
      :root { --bg:#0b1020; --fg:#e6ebff; --muted:#9aa4c8; --card:#111735cc; }
      html,body{height:100%;margin:0}
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--fg); background:var(--bg);}
      canvas#fx{position:fixed;inset:0;z-index:-1;display:block}
      header{padding:24px 16px 8px;max-width:960px;margin:0 auto}
      h1{margin:0;font-size:28px}
      p.sub{margin:6px 0 0;color:var(--muted)}
      main{max-width:960px;margin:16px auto;padding:0 16px 48px}
      .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
      .card{background:var(--card);border:1px solid #263057; border-radius:12px; padding:14px; text-decoration:none; color:inherit; transition:transform .1s ease, background .2s}
      .card:hover{transform:translateY(-2px); background:#151c45cc}
      .title{font-size:16px;line-height:1.3;margin:0 0 8px}
      .meta{font-size:12px;color:var(--muted)}
      footer{max-width:960px;margin:16px auto 32px;padding:0 16px;color:var(--muted);font-size:12px}
    </style>
  </head>
  <body>
    <canvas id="fx"></canvas>
    <header>
      <h1>ArxivCaster</h1>
      <p class="sub">毎日の arXiv 論文を要約して音声配信</p>
    </header>
    <main>
      <div id="list" class="grid"></div>
    </main>
    <footer>
      <span id="updated"></span>
      <span style="float:right"><a href="podcast.xml" style="color:#cfd8ff">RSS</a></span>
    </footer>
    <script>
      // Value noise-based background
      (function(){
        const c = document.getElementById('fx');
        const ctx = c.getContext('2d');
        let w,h, t=0; const scale=0.002;
        function rand(n){ const x=Math.sin(n)*43758.5453; return x-Math.floor(x); }
        function hash(x,y){ return rand(x*374761393 + y*668265263); }
        function lerp(a,b,t){ return a+(b-a)*t }
        function smoothstep(t){ return t*t*(3-2*t) }
        function noise2(x,y){
          const xi=Math.floor(x), yi=Math.floor(y);
          const xf=x-xi, yf=y-yi;
          const a=hash(xi,yi), b=hash(xi+1,yi), c=hash(xi,yi+1), d=hash(xi+1,yi+1);
          const u=smoothstep(xf), v=smoothstep(yf);
          return lerp(lerp(a,b,u), lerp(c,d,u), v);
        }
        function resize(){ w=c.width=innerWidth; h=c.height=innerHeight }
        addEventListener('resize', resize, {passive:true}); resize();
        function draw(){
          const img = ctx.createImageData(w,h); const data=img.data;
          for(let y=0;y<h;y+=2){ // step 2px for perf
            for(let x=0;x<w;x+=2){
              const n = noise2(x*scale, y*scale + t)*0.7 + noise2(x*scale*0.5, y*scale*0.5 + t*0.7)*0.3;
              const r = 10 + n*15, g = 18 + n*40, b = 70 + n*90;
              for(let dy=0;dy<2;dy++) for(let dx=0;dx<2;dx++){
                const i=((y+dy)*w + (x+dx))*4; data[i]=r; data[i+1]=g; data[i+2]=b; data[i+3]=255;
              }
            }
          }
          ctx.putImageData(img,0,0);
          t += 0.003; requestAnimationFrame(draw);
        }
        draw();
      })();

      async function loadIndex(){
        try{
          const res = await fetch('index.json');
          const data = await res.json();
          document.getElementById('updated').textContent = `最終更新: ${new Date(data.updatedAt).toLocaleString('ja-JP')}`;
          const list = document.getElementById('list');
          list.innerHTML = '';
          for(const it of data.items){
            const a = document.createElement('a');
            a.className='card';
            a.href = `viewer.html?slug=${encodeURIComponent(it.slug)}`;
            a.innerHTML = `<h3 class="title">${escapeHtml(it.title)}</h3><div class="meta">${new Date(it.date).toLocaleString('ja-JP')}・${it.slug}</div>`;
            list.appendChild(a);
          }
        }catch(e){ console.error(e); }
      }
      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }
      loadIndex();
    </script>
  </body>
  </html>

